# 故障汇总功能说明

## 概述

新增了智能故障汇总功能,自动整合后端所有服务的分析结果,**只显示有问题的内容**,并按严重程度分类展示。

## 主要特性

### 1. 智能故障提取
系统会自动从以下所有后端服务中提取故障信息:

#### 关键故障类型
- **线缆/光模块故障**
  - 温度过高 (≥70°C)
  - 光功率告警 (TX/RX)
  - 线缆不符合规格

- **误码率 (BER) 故障**
  - 严重超标端口
  - 偏高端口
  - 高级多通道分析

- **网络拥塞**
  - 严重拥塞 (等待比例 ≥5%)
  - 中度拥塞 (1-5%)
  - FECN/BECN检测

- **硬件健康**
  - 风扇转速异常
  - 温度传感器告警
  - 电源故障
  - PCIe速度降级

- **性能问题**
  - 延迟异常
  - 端口健康问题
  - 计数器异常

- **配置问题**
  - 固件版本过旧
  - 路由错误
  - 拓扑警告

### 2. 三级严重度分类

#### 🔴 严重故障 (Critical)
- 影响网络正常运行的问题
- 可能导致数据丢失或服务中断
- 需要立即处理

**示例:**
- 光模块温度 ≥80°C
- 误码率严重超标
- 端口严重拥塞 (≥5%)
- PCIe速度降级
- FEC不可纠正块

#### ⚠️ 警告 (Warning)
- 可能影响性能的问题
- 需要关注但不紧急
- 建议近期处理

**示例:**
- 光模块温度 70-80°C
- 误码率偏高
- 中度拥塞 (1-5%)
- 固件版本过旧

#### ℹ️ 提示信息 (Info)
- 配置建议
- 最佳实践提醒
- 可选优化项

**示例:**
- 节点描述重复
- 固件版本不统一
- 线缆测量问题

### 3. 知识库集成

每个故障都关联了详细的知识库信息:

- **为什么重要**: 解释该问题的影响
- **可能原因**: 列出常见的根本原因 (最多3条)
- **建议操作**: 提供具体的修复步骤 (最多4步)
- **预计修复时间**: MTTR估算
- **参考文档**: 官方文档链接

### 4. 用户交互设计

#### 可折叠分类
- 点击严重度类别可展开/折叠
- 默认显示故障数量
- 快速定位问题类型

#### 详情按需展开
- 每个故障项都有"查看详情"按钮
- 点击展开完整知识库信息
- 避免信息过载

## 显示位置

故障汇总显示在 **Overview (概览)** 页面的**最顶部**,确保用户第一时间看到所有问题。

## 使用场景

### 场景1: 日常健康检查
运维人员上传IBDiagnet结果后,直接在Overview页面查看故障汇总,快速了解网络整体健康状况。

### 场景2: 故障排查
当网络出现问题时,运维人员可以:
1. 查看严重故障列表
2. 展开详情获取修复建议
3. 按优先级处理问题

### 场景3: 定期巡检报告
- 无故障时显示绿色"网络健康状况良好"
- 有故障时按类别汇总,便于生成巡检报告

## 技术实现

### 新增文件
- `frontend/src/FaultSummary.jsx` - 故障汇总组件

### 修改文件
- `frontend/src/App.jsx` - 在Overview页面集成FaultSummary组件

### 数据流程
```
后端分析服务 (30+个服务)
    ↓
result.data (包含所有分析结果)
    ↓
FaultSummary组件提取故障
    ↓
按严重度分类
    ↓
前端展示
```

## 故障检测覆盖范围

系统目前检测以下类型的问题:

### 物理层
1. ✅ 线缆温度
2. ✅ 光功率告警
3. ✅ 线缆规格
4. ✅ 误码率 (BER)
5. ✅ BER高级分析
6. ✅ 每通道性能

### 网络层
7. ✅ 拥塞分析
8. ✅ FECN/BECN
9. ✅ 延迟异常
10. ✅ 路由错误
11. ✅ 端口健康

### 硬件层
12. ✅ 风扇状态
13. ✅ 温度传感器
14. ✅ 电源状态
15. ✅ PCIe性能
16. ✅ 固件版本

### 性能层
17. ✅ MLNX计数器
18. ✅ PM Delta (性能增量)
19. ✅ 信用看门狗
20. ✅ 温度告警

### 配置层
21. ✅ 拓扑警告
22. ✅ ibdiagnet警告汇总

## 未来扩展

可以继续添加以下检测:
- [ ] 交换机健康评分
- [ ] SHARP性能分析
- [ ] 虚拟化端口问题
- [ ] QoS配置建议
- [ ] 安全策略检查

## 示例输出

### 无故障场景
```
✅ 网络健康状况良好
未发现严重问题或警告
```

### 有故障场景
```
🔴 故障汇总
严重故障: 3  警告: 5  提示: 2

🔴 严重故障 (Critical) (3)
  [线缆/光模块] 2 个光模块温度过高 (≥70°C)  [查看详情]
  [误码率 (BER)] 1 个端口误码率严重超标  [查看详情]
  [拥塞分析] 5 个端口严重拥塞 (等待比例 ≥5%)  [查看详情]

⚠️ 警告 (Warning) (5)
  [固件版本] 10 个设备固件版本过旧  [查看详情]
  ...
```

## 用户反馈优化

基于用户需求实现的改进:
1. ✅ 不显示没有故障的内容
2. ✅ 故障优先排序 (严重→警告→提示)
3. ✅ 每个故障标记原因和来源
4. ✅ 按类别分组便于管理
5. ✅ 集成知识库提供修复建议

## 总结

故障汇总功能将后端30+个服务的分析结果智能整合,只显示有问题的内容,并提供分类、优先级和修复建议,极大提升了运维效率。
