# IBDiagnet å¥åº·æ£€æŸ¥å®Œæ•´æŒ‡å—

åŸºäº **IBDiagnet User Manual v2.13.0** å®˜æ–¹æ–‡æ¡£

---

## ğŸ“‹ ç›®å½•

1. [IBDiagnet å·¥å…·æ¦‚è¿°](#1-ibdiagnet-å·¥å…·æ¦‚è¿°)
2. [æ ¸å¿ƒå¥åº·æ£€æŸ¥åŠŸèƒ½](#2-æ ¸å¿ƒå¥åº·æ£€æŸ¥åŠŸèƒ½)
3. [æ£€æŸ¥é¡¹è¯¦è§£](#3-æ£€æŸ¥é¡¹è¯¦è§£)
4. [è¾“å‡ºæ–‡ä»¶è¯´æ˜](#4-è¾“å‡ºæ–‡ä»¶è¯´æ˜)
5. [æ€§èƒ½è®¡æ•°å™¨ (PM Counters)](#5-æ€§èƒ½è®¡æ•°å™¨-pm-counters)
6. [é”™è¯¯æ£€æµ‹æœºåˆ¶](#6-é”™è¯¯æ£€æµ‹æœºåˆ¶)
7. [å‘½ä»¤è¡Œå‚æ•°](#7-å‘½ä»¤è¡Œå‚æ•°)
8. [å®æˆ˜åº”ç”¨åœºæ™¯](#8-å®æˆ˜åº”ç”¨åœºæ™¯)

---

## 1. IBDiagnet å·¥å…·æ¦‚è¿°

### 1.1 å·¥å…·å®šä½
**IBDiagnet** æ˜¯ NVIDIA æä¾›çš„ InfiniBand ç½‘ç»œè¯Šæ–­å·¥å…·ï¼Œç”¨äºï¼š
- å‘ç°å’ŒéªŒè¯ IB ç½‘ç»œæ‹“æ‰‘
- æ£€æµ‹é“¾è·¯å’ŒèŠ‚ç‚¹é”™è¯¯
- æ”¶é›†æ€§èƒ½è®¡æ•°å™¨
- ç”Ÿæˆç½‘ç»œå¥åº·æŠ¥å‘Š

### 1.2 å·¥ä½œåŸç†
1. **æ‹“æ‰‘å‘ç°**: é€šè¿‡ Subnet Management (SM) æ‰«ææ•´ä¸ª IB fabric
2. **æ•°æ®æ”¶é›†**: æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹å’Œç«¯å£çš„çŠ¶æ€ã€è®¡æ•°å™¨
3. **é”™è¯¯æ£€æµ‹**: å¯¹æ¯”é˜ˆå€¼ï¼Œè¯†åˆ«å¼‚å¸¸
4. **æŠ¥å‘Šç”Ÿæˆ**: è¾“å‡ºå¤šç§æ ¼å¼çš„è¯Šæ–­æŠ¥å‘Š

### 1.3 è¿è¡Œæ¨¡å¼
- **æœ¬åœ°æ¨¡å¼**: åœ¨ IB ç½‘ç»œå†…çš„èŠ‚ç‚¹ä¸Šè¿è¡Œ
- **è¿œç¨‹æ¨¡å¼**: é€šè¿‡ SM è¿œç¨‹è¯Šæ–­
- **ç¦»çº¿æ¨¡å¼**: åˆ†æå·²ä¿å­˜çš„ç½‘ç»œå¿«ç…§

---

## 2. æ ¸å¿ƒå¥åº·æ£€æŸ¥åŠŸèƒ½

### 2.1 æ‹“æ‰‘éªŒè¯ (Topology Validation)

#### æ£€æŸ¥é¡¹
- **èŠ‚ç‚¹è¿æ¥æ€§**: éªŒè¯æ‰€æœ‰èŠ‚ç‚¹å¯è¾¾
- **é“¾è·¯å®Œæ•´æ€§**: æ£€æŸ¥ç‰©ç†è¿æ¥çŠ¶æ€
- **æ‹“æ‰‘ä¸€è‡´æ€§**: å¯¹æ¯”é¢„æœŸæ‹“æ‰‘æ–‡ä»¶
- **é‡å¤ GUID**: æ£€æµ‹ GUID å†²çª

#### è¾“å‡ºæ–‡ä»¶
- `ibdiagnet2.topology`: å®Œæ•´æ‹“æ‰‘æè¿°
- `ibdiagnet2.net_dump`: ç½‘ç»œè½¬å‚¨æ–‡ä»¶
- `ibdiagnet2.lst`: èŠ‚ç‚¹åˆ—è¡¨

### 2.2 é“¾è·¯è´¨é‡æ£€æŸ¥ (Link Quality)

#### ç‰©ç†å±‚æ£€æŸ¥
- **é“¾è·¯é€Ÿåº¦**: SDR/DDR/QDR/FDR/EDR/HDR/NDR
- **é“¾è·¯å®½åº¦**: 1x/4x/8x/12x
- **é“¾è·¯çŠ¶æ€**: Active/Down/Init/Armed
- **ç‰©ç†çŠ¶æ€**: LinkUp/Sleep/Polling/Disabled

#### ä¿¡å·è´¨é‡
- **BER (Bit Error Rate)**: è¯¯ç ç‡æµ‹é‡
  - Raw BER: åŸå§‹è¯¯ç ç‡
  - Effective BER: FEC çº é”™åçš„æœ‰æ•ˆè¯¯ç ç‡
  - Symbol BER: ç¬¦å·çº§è¯¯ç ç‡
- **ä¿¡å·å®Œæ•´æ€§**: çœ¼å›¾è´¨é‡ã€æŠ–åŠ¨

### 2.3 æ€§èƒ½ç›‘æ§ (Performance Monitoring)

#### PM è®¡æ•°å™¨ç±»å‹
1. **æµé‡è®¡æ•°å™¨**:
   - `PortXmitData`: å‘é€æ•°æ®é‡
   - `PortRcvData`: æ¥æ”¶æ•°æ®é‡
   - `PortXmitPkts`: å‘é€åŒ…æ•°
   - `PortRcvPkts`: æ¥æ”¶åŒ…æ•°

2. **æ‹¥å¡è®¡æ•°å™¨**:
   - `PortXmitWait`: å‘é€ç­‰å¾…æ—¶é—´
   - `PortXmitTimeCong`: æ‹¥å¡æ—¶é—´
   - `PortRcvFECN`: å‰å‘æ‹¥å¡é€šçŸ¥
   - `PortRcvBECN`: åå‘æ‹¥å¡é€šçŸ¥

3. **é”™è¯¯è®¡æ•°å™¨**:
   - `SymbolErrorCounter`: ç¬¦å·é”™è¯¯
   - `LinkErrorRecoveryCounter`: é“¾è·¯æ¢å¤æ¬¡æ•°
   - `LinkDownedCounter`: é“¾è·¯æ–­å¼€æ¬¡æ•°
   - `PortRcvErrors`: æ¥æ”¶é”™è¯¯
   - `PortRcvRemotePhysicalErrors`: è¿œç«¯ç‰©ç†é”™è¯¯
   - `PortRcvSwitchRelayErrors`: äº¤æ¢æœºä¸­ç»§é”™è¯¯
   - `PortXmitDiscards`: å‘é€ä¸¢å¼ƒ
   - `PortXmitConstraintErrors`: å‘é€çº¦æŸé”™è¯¯
   - `PortRcvConstraintErrors`: æ¥æ”¶çº¦æŸé”™è¯¯
   - `LocalLinkIntegrityErrors`: æœ¬åœ°é“¾è·¯å®Œæ•´æ€§é”™è¯¯
   - `ExcessiveBufferOverrunErrors`: ç¼“å†²åŒºæº¢å‡ºé”™è¯¯

### 2.4 å…‰æ¨¡å—ç›‘æ§ (Cable/Transceiver Monitoring)

#### ç›‘æ§å‚æ•°
- **æ¸©åº¦**: å·¥ä½œæ¸©åº¦ (Â°C)
- **ç”µå‹**: ä¾›ç”µç”µå‹ (V)
- **å…‰åŠŸç‡**: TX/RX å…‰åŠŸç‡ (dBm)
- **åç½®ç”µæµ**: Bias Current (mA)

#### ä¾›åº”å•†ä¿¡æ¯
- **Vendor**: åˆ¶é€ å•†
- **Part Number (PN)**: å‹å·
- **Serial Number (SN)**: åºåˆ—å·
- **Firmware Version**: å›ºä»¶ç‰ˆæœ¬
- **Revision**: ç¡¬ä»¶ç‰ˆæœ¬

#### å‘Šè­¦é˜ˆå€¼
- **æ¸©åº¦å‘Šè­¦**: é€šå¸¸ 70-85Â°C
- **å…‰åŠŸç‡å‘Šè­¦**: TX/RX åŠŸç‡è¶…å‡ºèŒƒå›´
- **ç”µå‹å‘Šè­¦**: ä¾›ç”µå¼‚å¸¸

### 2.5 å›ºä»¶å’Œé…ç½®æ£€æŸ¥

#### å›ºä»¶ç‰ˆæœ¬
- **HCA å›ºä»¶**: ä¸»æœºé€‚é…å™¨å›ºä»¶
- **Switch å›ºä»¶**: äº¤æ¢æœºå›ºä»¶
- **Cable å›ºä»¶**: æœ‰æºå…‰ç¼†å›ºä»¶

#### é…ç½®ä¸€è‡´æ€§
- **MTU**: æœ€å¤§ä¼ è¾“å•å…ƒ
- **VL (Virtual Lane)**: è™šæ‹Ÿé€šé“é…ç½®
- **SL2VL Mapping**: æœåŠ¡çº§åˆ«åˆ°è™šæ‹Ÿé€šé“æ˜ å°„
- **Partition Key (PKey)**: åˆ†åŒºå¯†é’¥

---

## 3. æ£€æŸ¥é¡¹è¯¦è§£

### 3.1 Critical çº§åˆ«æ£€æŸ¥

#### 1. é“¾è·¯æ–­å¼€ (Link Down)
**æ£€æµ‹**: `LinkDownedCounter > 0`
**å½±å“**: ç½‘ç»œè¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¼ è¾“å¤±è´¥
**åŸå› **:
- ç‰©ç†è¿æ¥æ¾åŠ¨
- å…‰æ¨¡å—æ•…éšœ
- ç«¯å£é…ç½®é”™è¯¯
- ç”µæºé—®é¢˜

**å¤„ç†**:
1. æ£€æŸ¥ç‰©ç†è¿æ¥
2. æ›´æ¢æ•…éšœå…‰æ¨¡å—
3. æ£€æŸ¥ç«¯å£é…ç½®
4. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

#### 2. é«˜è¯¯ç ç‡ (High BER)
**æ£€æµ‹**: `Symbol BER > 1e-12` (å…¸å‹é˜ˆå€¼)
**å½±å“**: æ•°æ®ä¼ è¾“é”™è¯¯ï¼Œæ€§èƒ½ä¸‹é™
**åŸå› **:
- å…‰æ¨¡å—è€åŒ–
- å…‰çº¤æ±¡æŸ“/æŸå
- ä¿¡å·è¡°å‡è¿‡å¤§
- EMI å¹²æ‰°

**å¤„ç†**:
1. æ¸…æ´å…‰çº¤æ¥å£
2. æ£€æŸ¥å…‰åŠŸç‡
3. æ›´æ¢å…‰æ¨¡å—/å…‰çº¤
4. æ£€æŸ¥ç¯å¢ƒå¹²æ‰°

#### 3. é«˜æ¸©å‘Šè­¦ (High Temperature)
**æ£€æµ‹**: `Temperature >= 80Â°C`
**å½±å“**: è®¾å¤‡å¯¿å‘½ç¼©çŸ­ï¼Œå¯èƒ½å¯¼è‡´æ•…éšœ
**åŸå› **:
- æ•£çƒ­ä¸è‰¯
- ç¯å¢ƒæ¸©åº¦è¿‡é«˜
- é£æ‰‡æ•…éšœ
- é«˜è´Ÿè½½è¿è¡Œ

**å¤„ç†**:
1. æ”¹å–„æœºæˆ¿æ•£çƒ­
2. æ£€æŸ¥é£æ‰‡è¿è¡Œ
3. é™ä½è´Ÿè½½
4. æ›´æ¢æ•£çƒ­ç»„ä»¶

#### 4. ç¬¦å·é”™è¯¯ (Symbol Errors)
**æ£€æµ‹**: `SymbolErrorCounter > 0`
**å½±å“**: æ•°æ®å®Œæ•´æ€§é—®é¢˜
**åŸå› **:
- ç‰©ç†å±‚é—®é¢˜
- æ—¶é’ŸåŒæ­¥é—®é¢˜
- ä¿¡å·è´¨é‡å·®

**å¤„ç†**:
1. æ£€æŸ¥é“¾è·¯è´¨é‡
2. æ›´æ¢å¯ç–‘ç»„ä»¶
3. è°ƒæ•´ä¿¡å·å‚æ•°

### 3.2 Warning çº§åˆ«æ£€æŸ¥

#### 1. æ‹¥å¡ (Congestion)
**æ£€æµ‹**: `PortXmitWait` æŒç»­å¢é•¿
**å½±å“**: æ€§èƒ½ä¸‹é™ï¼Œå»¶è¿Ÿå¢åŠ 
**åŸå› **:
- æµé‡ä¸å‡è¡¡
- è·¯ç”±é…ç½®ä¸å½“
- ç«¯å£é€Ÿç‡ä¸åŒ¹é…
- åº”ç”¨å±‚é—®é¢˜

**å¤„ç†**:
1. åˆ†ææµé‡æ¨¡å¼
2. ä¼˜åŒ–è·¯ç”±é…ç½®
3. å¯ç”¨ QoS
4. å‡çº§é“¾è·¯å¸¦å®½

#### 2. é“¾è·¯æ¢å¤ (Link Recovery)
**æ£€æµ‹**: `LinkErrorRecoveryCounter > 0`
**å½±å“**: çŸ­æš‚æ€§èƒ½ä¸‹é™
**åŸå› **:
- ç¬æ—¶ä¿¡å·é—®é¢˜
- ç”µæºæ³¢åŠ¨
- ç¯å¢ƒå¹²æ‰°

**å¤„ç†**:
1. ç›‘æ§é¢‘ç‡
2. æ£€æŸ¥ç”µæºç¨³å®šæ€§
3. æ’æŸ¥å¹²æ‰°æº

#### 3. ä¸­ç­‰æ¸©åº¦ (Moderate Temperature)
**æ£€æµ‹**: `70Â°C <= Temperature < 80Â°C`
**å½±å“**: é¢„è­¦ï¼Œéœ€å…³æ³¨
**å¤„ç†**: æ”¹å–„æ•£çƒ­ï¼ŒæŒç»­ç›‘æ§

### 3.3 Info çº§åˆ«æ£€æŸ¥

#### 1. å›ºä»¶ç‰ˆæœ¬ä¸ä¸€è‡´
**æ£€æµ‹**: åŒç±»è®¾å¤‡å›ºä»¶ç‰ˆæœ¬ä¸åŒ
**å½±å“**: å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜
**å¤„ç†**: ç»Ÿä¸€å›ºä»¶ç‰ˆæœ¬

#### 2. é…ç½®ä¸ä¸€è‡´
**æ£€æµ‹**: MTU/VL/PKey é…ç½®å·®å¼‚
**å½±å“**: å¯èƒ½å½±å“é€šä¿¡
**å¤„ç†**: æ ‡å‡†åŒ–é…ç½®

#### 3. è´Ÿè½½ä¸å‡è¡¡
**æ£€æµ‹**: åŒç»„é“¾è·¯æµé‡å·®å¼‚å¤§
**å½±å“**: èµ„æºåˆ©ç”¨ç‡ä½
**å¤„ç†**: ä¼˜åŒ–è´Ÿè½½å‡è¡¡ç®—æ³•

---

## 4. è¾“å‡ºæ–‡ä»¶è¯´æ˜

### 4.1 ä¸»è¦è¾“å‡ºæ–‡ä»¶

#### ibdiagnet2.db_csv
**æ ¼å¼**: CSV æ•°æ®åº“æ–‡ä»¶
**å†…å®¹**: åŒ…å«å¤šä¸ªè¡¨çš„ç»¼åˆæ•°æ®
**è¡¨ç»“æ„**:
```
[TABLE_NAME]
header1,header2,header3,...
value1,value2,value3,...
...
[END_TABLE]
```

**å…³é”®è¡¨**:
- `NODES_INFO`: èŠ‚ç‚¹ä¿¡æ¯ï¼ˆGUID, è®¾å¤‡ç±»å‹, å›ºä»¶ç‰ˆæœ¬ç­‰ï¼‰
- `CABLE_INFO`: å…‰æ¨¡å—ä¿¡æ¯ï¼ˆæ¸©åº¦, ä¾›åº”å•†, PN ç­‰ï¼‰
- `PM_DELTA`: æ€§èƒ½è®¡æ•°å™¨å¢é‡
- `PHY_DB16`: BER æ•°æ®
- `PORT_INFO`: ç«¯å£çŠ¶æ€ä¿¡æ¯

#### ibdiagnet2.net_dump
**æ ¼å¼**: æ–‡æœ¬æ ¼å¼ç½‘ç»œè½¬å‚¨
**å†…å®¹**: å®Œæ•´çš„ç½‘ç»œæ‹“æ‰‘å’ŒçŠ¶æ€ä¿¡æ¯
**ç”¨é€”**: ç¦»çº¿åˆ†æã€é—®é¢˜å¤ç°

#### ibdiagnet2.net_dump_ext
**æ ¼å¼**: æ‰©å±•ç½‘ç»œè½¬å‚¨
**å†…å®¹**: åŒ…å«æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼ˆBER, PM ç­‰ï¼‰
**ä¼˜åŠ¿**: æ›´å¿«çš„è§£æé€Ÿåº¦

#### ibdiagnet2.pm
**æ ¼å¼**: æ€§èƒ½è®¡æ•°å™¨æ–‡ä»¶
**å†…å®¹**: æ‰€æœ‰ç«¯å£çš„ PM è®¡æ•°å™¨å¿«ç…§
**ç”¨é€”**: æ€§èƒ½åˆ†æã€è¶‹åŠ¿ç›‘æ§

#### ibdiagnet2.topology
**æ ¼å¼**: æ‹“æ‰‘æè¿°æ–‡ä»¶
**å†…å®¹**: èŠ‚ç‚¹å’Œé“¾è·¯çš„å±‚æ¬¡ç»“æ„
**ç”¨é€”**: æ‹“æ‰‘å¯è§†åŒ–ã€å¯¹æ¯”éªŒè¯

### 4.2 æ—¥å¿—æ–‡ä»¶

#### ibdiagnet2.log
**å†…å®¹**: è¿è¡Œæ—¥å¿—
**çº§åˆ«**: INFO/WARNING/ERROR
**ç”¨é€”**: æ•…éšœæ’æŸ¥

#### ibdiagnet2.fdbs
**å†…å®¹**: è½¬å‘æ•°æ®åº“
**ç”¨é€”**: è·¯ç”±åˆ†æ

---

## 5. æ€§èƒ½è®¡æ•°å™¨ (PM Counters)

### 5.1 è®¡æ•°å™¨åˆ†ç±»

#### åŸºç¡€è®¡æ•°å™¨ (32-bit)
- `PortXmitData`
- `PortRcvData`
- `PortXmitPkts`
- `PortRcvPkts`

#### æ‰©å±•è®¡æ•°å™¨ (64-bit)
- `PortXmitDataExtended`
- `PortRcvDataExtended`
- `PortXmitPktsExtended`
- `PortRcvPktsExtended`

#### é”™è¯¯è®¡æ•°å™¨
- `SymbolErrorCounter`
- `LinkErrorRecoveryCounter`
- `LinkDownedCounter`
- `PortRcvErrors`
- `PortRcvRemotePhysicalErrors`
- `PortRcvSwitchRelayErrors`
- `PortXmitDiscards`
- `PortXmitConstraintErrors`
- `PortRcvConstraintErrors`
- `LocalLinkIntegrityErrors`
- `ExcessiveBufferOverrunErrors`

### 5.2 è®¡æ•°å™¨è§£è¯»

#### PortXmitWait
**å«ä¹‰**: ç«¯å£å› æ‹¥å¡ç­‰å¾…å‘é€çš„æ—¶é—´
**å•ä½**: Ticks (4ns per tick)
**è®¡ç®—**: `Wait_Time = PortXmitWait Ã— 4ns`
**é˜ˆå€¼**:
- æ­£å¸¸: < 1% çš„æ€»æ—¶é—´
- è­¦å‘Š: 1-5%
- ä¸¥é‡: > 5%

**ç¤ºä¾‹**:
```
é‡‡æ ·é—´éš”: 60 ç§’
PortXmitWait: 1,500,000,000 ticks
ç­‰å¾…æ—¶é—´: 1,500,000,000 Ã— 4ns = 6 ç§’
æ‹¥å¡æ¯”ä¾‹: 6/60 = 10% (ä¸¥é‡æ‹¥å¡)
```

#### PortXmitData
**å«ä¹‰**: å‘é€çš„æ•°æ®é‡
**å•ä½**: 4-byte words
**è®¡ç®—**: `Data_Bytes = PortXmitData Ã— 4`
**ç”¨é€”**: å¸¦å®½åˆ©ç”¨ç‡è®¡ç®—

**ç¤ºä¾‹**:
```
é‡‡æ ·é—´éš”: 60 ç§’
PortXmitData: 25,000,000,000 words
æ•°æ®é‡: 25,000,000,000 Ã— 4 = 100 GB
å¸¦å®½: 100 GB / 60s = 1.67 GB/s = 13.3 Gbps
```

#### SymbolErrorCounter
**å«ä¹‰**: ç¬¦å·çº§é”™è¯¯æ•°é‡
**é˜ˆå€¼**: åº”ä¸º 0
**å½±å“**: ä»»ä½•éé›¶å€¼éƒ½è¡¨ç¤ºç‰©ç†å±‚é—®é¢˜

### 5.3 è®¡æ•°å™¨é‡‡æ ·ç­–ç•¥

#### å•æ¬¡é‡‡æ ·
```bash
ibdiagnet --pm
```
**ç”¨é€”**: è·å–å½“å‰è®¡æ•°å™¨å€¼

#### å¢é‡é‡‡æ ·
```bash
ibdiagnet --pm_pause_time 60
```
**ç”¨é€”**: è®¡ç®— 60 ç§’å†…çš„å¢é‡
**ä¼˜åŠ¿**: æ›´å‡†ç¡®çš„æ€§èƒ½åˆ†æ

#### æŒç»­ç›‘æ§
```bash
while true; do
  ibdiagnet --pm_pause_time 60
  sleep 60
done
```
**ç”¨é€”**: é•¿æœŸè¶‹åŠ¿åˆ†æ

---

## 6. é”™è¯¯æ£€æµ‹æœºåˆ¶

### 6.1 é”™è¯¯åˆ†ç±»

#### ç‰©ç†å±‚é”™è¯¯
- **Symbol Errors**: ç¬¦å·é”™è¯¯
- **Link Integrity Errors**: é“¾è·¯å®Œæ•´æ€§é”™è¯¯
- **Physical Errors**: ç‰©ç†é”™è¯¯

#### é“¾è·¯å±‚é”™è¯¯
- **CRC Errors**: å¾ªç¯å†—ä½™æ ¡éªŒé”™è¯¯
- **VL15 Dropped**: VL15 ä¸¢åŒ…
- **Buffer Overrun**: ç¼“å†²åŒºæº¢å‡º

#### ç½‘ç»œå±‚é”™è¯¯
- **Routing Errors**: è·¯ç”±é”™è¯¯
- **Partition Errors**: åˆ†åŒºé”™è¯¯
- **Constraint Errors**: çº¦æŸé”™è¯¯

### 6.2 é”™è¯¯é˜ˆå€¼

#### é›¶å®¹å¿é”™è¯¯
ä»¥ä¸‹è®¡æ•°å™¨åº”å§‹ç»ˆä¸º 0ï¼š
- `SymbolErrorCounter`
- `LinkDownedCounter`
- `PortRcvErrors`
- `PortRcvRemotePhysicalErrors`
- `LocalLinkIntegrityErrors`

#### ä½é¢‘é”™è¯¯
ä»¥ä¸‹è®¡æ•°å™¨åº”ä¿æŒä½é¢‘ï¼š
- `LinkErrorRecoveryCounter`: < 1/å°æ—¶
- `PortXmitDiscards`: < 0.01% çš„åŒ…

### 6.3 é”™è¯¯å¤„ç†æµç¨‹

```
æ£€æµ‹é”™è¯¯
    â†“
ç¡®å®šé”™è¯¯ç±»å‹
    â†“
å®šä½æ•…éšœèŠ‚ç‚¹/é“¾è·¯
    â†“
åˆ†ææ ¹æœ¬åŸå› 
    â†“
å®æ–½ä¿®å¤æªæ–½
    â†“
éªŒè¯ä¿®å¤æ•ˆæœ
    â†“
æŒç»­ç›‘æ§
```

---

## 7. å‘½ä»¤è¡Œå‚æ•°

### 7.1 åŸºç¡€å‚æ•°

#### æ‹“æ‰‘å‘ç°
```bash
ibdiagnet
```
**åŠŸèƒ½**: åŸºç¡€æ‹“æ‰‘æ‰«æå’ŒéªŒè¯

#### æ€§èƒ½ç›‘æ§
```bash
ibdiagnet --pm
```
**åŠŸèƒ½**: æ”¶é›†æ€§èƒ½è®¡æ•°å™¨

#### å¢é‡ç›‘æ§
```bash
ibdiagnet --pm_pause_time <seconds>
```
**åŠŸèƒ½**: é‡‡æ ·é—´éš”åè®¡ç®—å¢é‡

### 7.2 é«˜çº§å‚æ•°

#### æŒ‡å®šè¾“å‡ºç›®å½•
```bash
ibdiagnet -o /path/to/output
```

#### æŒ‡å®šæ‹“æ‰‘æ–‡ä»¶
```bash
ibdiagnet -t topology_file
```
**ç”¨é€”**: å¯¹æ¯”éªŒè¯

#### è·³è¿‡é”™è¯¯æ£€æŸ¥
```bash
ibdiagnet --skip <check_name>
```
**ç¤ºä¾‹**: `--skip dup_guids`

#### è¯¦ç»†æ—¥å¿—
```bash
ibdiagnet -v
```

#### ä»…æ£€æŸ¥ç‰¹å®šèŠ‚ç‚¹
```bash
ibdiagnet --node_name_map <file>
```

### 7.3 å¸¸ç”¨ç»„åˆ

#### å®Œæ•´å¥åº·æ£€æŸ¥
```bash
ibdiagnet --pm_pause_time 60 -o /var/log/ibdiagnet/$(date +%Y%m%d_%H%M%S)
```

#### å¿«é€Ÿæ‹“æ‰‘éªŒè¯
```bash
ibdiagnet -t expected_topology.txt
```

#### æ€§èƒ½åŸºå‡†æµ‹è¯•
```bash
ibdiagnet --pm_pause_time 300 --pm
```

---

## 8. å®æˆ˜åº”ç”¨åœºæ™¯

### 8.1 æ—¥å¸¸å¥åº·æ£€æŸ¥

#### æ£€æŸ¥æ¸…å•
- [ ] æ‹“æ‰‘å®Œæ•´æ€§
- [ ] é“¾è·¯çŠ¶æ€
- [ ] é”™è¯¯è®¡æ•°å™¨
- [ ] æ€§èƒ½è®¡æ•°å™¨
- [ ] å…‰æ¨¡å—æ¸©åº¦
- [ ] å›ºä»¶ç‰ˆæœ¬

#### è‡ªåŠ¨åŒ–è„šæœ¬
```bash
#!/bin/bash
# daily_health_check.sh

DATE=$(date +%Y%m%d)
OUTPUT_DIR="/var/log/ibdiagnet/$DATE"
mkdir -p $OUTPUT_DIR

# è¿è¡Œè¯Šæ–­
ibdiagnet --pm_pause_time 60 -o $OUTPUT_DIR

# æ£€æŸ¥å…³é”®é”™è¯¯
if grep -q "ERRORS FOUND" $OUTPUT_DIR/ibdiagnet2.log; then
    echo "Errors detected! Check $OUTPUT_DIR/ibdiagnet2.log"
    # å‘é€å‘Šè­¦é‚®ä»¶
    mail -s "IB Network Errors Detected" admin@example.com < $OUTPUT_DIR/ibdiagnet2.log
fi

# å½’æ¡£æ—§æ—¥å¿—ï¼ˆä¿ç•™ 30 å¤©ï¼‰
find /var/log/ibdiagnet -type d -mtime +30 -exec rm -rf {} \;
```

### 8.2 æ•…éšœæ’æŸ¥

#### åœºæ™¯ 1: æ€§èƒ½ä¸‹é™
**ç—‡çŠ¶**: åº”ç”¨æŠ¥å‘Šå»¶è¿Ÿå¢åŠ 
**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ `PortXmitWait` - æ˜¯å¦æ‹¥å¡ï¼Ÿ
2. æ£€æŸ¥ `LinkErrorRecoveryCounter` - é“¾è·¯æ˜¯å¦ä¸ç¨³å®šï¼Ÿ
3. æ£€æŸ¥ BER - ä¿¡å·è´¨é‡æ˜¯å¦ä¸‹é™ï¼Ÿ
4. æ£€æŸ¥æ¸©åº¦ - æ˜¯å¦è¿‡çƒ­ï¼Ÿ

#### åœºæ™¯ 2: é—´æ­‡æ€§è¿æ¥ä¸­æ–­
**ç—‡çŠ¶**: å¶å°”å‡ºç°é€šä¿¡å¤±è´¥
**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ `LinkDownedCounter` - è®°å½•æ–­å¼€æ¬¡æ•°
2. æ£€æŸ¥ `SymbolErrorCounter` - ç‰©ç†å±‚é—®é¢˜ï¼Ÿ
3. æ£€æŸ¥å…‰æ¨¡å—æ¸©åº¦ - æ˜¯å¦æ¥è¿‘é˜ˆå€¼ï¼Ÿ
4. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿— - æ˜¯å¦æœ‰ç¡¬ä»¶å‘Šè­¦ï¼Ÿ

#### åœºæ™¯ 3: æ–°è®¾å¤‡ä¸Šçº¿åé—®é¢˜
**ç—‡çŠ¶**: æ·»åŠ æ–°èŠ‚ç‚¹åç½‘ç»œå¼‚å¸¸
**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥å›ºä»¶ç‰ˆæœ¬ - æ˜¯å¦å…¼å®¹ï¼Ÿ
2. æ£€æŸ¥é…ç½® - MTU/VL æ˜¯å¦ä¸€è‡´ï¼Ÿ
3. æ£€æŸ¥æ‹“æ‰‘ - æ˜¯å¦æœ‰ GUID å†²çªï¼Ÿ
4. æ£€æŸ¥è·¯ç”± - æ˜¯å¦æ­£ç¡®é…ç½®ï¼Ÿ

### 8.3 æ€§èƒ½ä¼˜åŒ–

#### è¯†åˆ«ç“¶é¢ˆ
```bash
# æ‰¾å‡º XmitWait æœ€é«˜çš„ç«¯å£
grep PortXmitWait ibdiagnet2.pm | sort -t',' -k3 -n | tail -20
```

#### è´Ÿè½½å‡è¡¡åˆ†æ
```bash
# æ¯”è¾ƒåŒç»„é“¾è·¯çš„æµé‡
grep "PortXmitData" ibdiagnet2.pm | grep "switch01" | awk -F',' '{print $2,$3}'
```

#### è¶‹åŠ¿åˆ†æ
```bash
# å¯¹æ¯”ä¸¤æ¬¡é‡‡æ ·
diff ibdiagnet_t1.pm ibdiagnet_t2.pm | grep PortXmitWait
```

### 8.4 å®¹é‡è§„åˆ’

#### å¸¦å®½åˆ©ç”¨ç‡è®¡ç®—
```python
def calculate_bandwidth_utilization(xmit_data, duration, link_speed):
    """
    xmit_data: PortXmitData å¢é‡ (4-byte words)
    duration: é‡‡æ ·é—´éš” (ç§’)
    link_speed: é“¾è·¯é€Ÿåº¦ (Gbps)
    """
    data_bytes = xmit_data * 4
    data_gbits = data_bytes * 8 / 1e9
    utilization = (data_gbits / duration) / link_speed * 100
    return utilization

# ç¤ºä¾‹
xmit_data = 25_000_000_000  # 25G words
duration = 60  # 60 ç§’
link_speed = 100  # 100 Gbps (HDR)

util = calculate_bandwidth_utilization(xmit_data, duration, link_speed)
print(f"Bandwidth Utilization: {util:.2f}%")
# è¾“å‡º: Bandwidth Utilization: 13.33%
```

#### æ‰©å®¹å»ºè®®
- **åˆ©ç”¨ç‡ > 70%**: è€ƒè™‘å‡çº§é“¾è·¯
- **XmitWait > 1%**: éœ€è¦å¢åŠ å¸¦å®½æˆ–ä¼˜åŒ–è·¯ç”±
- **é”™è¯¯ç‡ > 0**: ä¼˜å…ˆè§£å†³è´¨é‡é—®é¢˜

---

## 9. ä¸å¹³å°é›†æˆ

### 9.1 æ•°æ®æµ

```
IBDiagnet è¿è¡Œ
    â†“
ç”Ÿæˆ .db_csv / .net_dump_ext
    â†“
ä¸Šä¼ åˆ°å¹³å° (POST /api/upload/ibdiagnet)
    â†“
ib_analysis æ¨¡å—è§£æ
    â†“
æ‰§è¡Œå¥åº·æ£€æŸ¥æ“ä½œ (brief/ber/cable/xmit/hca)
    â†“
è®¡ç®—å¥åº·è¯„åˆ†
    â†“
å‰ç«¯å±•ç¤ºç»“æœ
```

### 9.2 å…³é”®æ˜ å°„

| IBDiagnet è¾“å‡º | ib_analysis æ¨¡å— | å¥åº·æ£€æŸ¥é¡¹ |
|---------------|-----------------|----------|
| PHY_DB16 è¡¨ | ber.py | BER åˆ†æ |
| CABLE_INFO è¡¨ | cable.py | å…‰æ¨¡å—ç›‘æ§ |
| PM_DELTA è¡¨ | xmit.py | æ‹¥å¡æ£€æµ‹ |
| NODES_INFO è¡¨ | hca.py | å›ºä»¶æ£€æŸ¥ |
| æ‰€æœ‰è¡¨ | brief.py | ç»¼åˆæ¦‚è§ˆ |

### 9.3 å¥åº·è¯„åˆ†å¯¹åº”

| IBDiagnet æ£€æµ‹é¡¹ | è¯„åˆ†ç±»åˆ« | æƒé‡ |
|----------------|---------|------|
| BER è¶…æ ‡ | ber | 25% |
| é”™è¯¯è®¡æ•°å™¨éé›¶ | errors | 25% |
| XmitWait è¿‡é«˜ | congestion | 20% |
| æ‹“æ‰‘å¼‚å¸¸ | topology | 10% |
| æ¸©åº¦å‘Šè­¦ | errors | è®¡å…¥ 25% |
| å›ºä»¶ä¸ä¸€è‡´ | config | 3% |

---

## 10. æœ€ä½³å®è·µ

### 10.1 ç›‘æ§é¢‘ç‡
- **ç”Ÿäº§ç¯å¢ƒ**: æ¯ 5-15 åˆ†é’Ÿ
- **æµ‹è¯•ç¯å¢ƒ**: æ¯å°æ—¶
- **æ•…éšœæ’æŸ¥**: æ¯åˆ†é’Ÿ

### 10.2 æ•°æ®ä¿ç•™
- **åŸå§‹æ•°æ®**: 30 å¤©
- **èšåˆæ•°æ®**: 1 å¹´
- **å‘Šè­¦è®°å½•**: æ°¸ä¹…

### 10.3 å‘Šè­¦ç­–ç•¥
- **Critical**: ç«‹å³é€šçŸ¥ï¼Œè‡ªåŠ¨åˆ›å»ºå·¥å•
- **Warning**: æ¯å°æ—¶æ±‡æ€»é€šçŸ¥
- **Info**: æ¯æ—¥æŠ¥å‘Š

### 10.4 ç»´æŠ¤çª—å£
- å®šæœŸå›ºä»¶å‡çº§
- å…‰æ¨¡å—æ¸…æ´
- é…ç½®å®¡è®¡
- æ€§èƒ½åŸºå‡†æµ‹è¯•

---

## é™„å½• A: é”™è¯¯ä»£ç å¯¹ç…§è¡¨

| é”™è¯¯ä»£ç  | å«ä¹‰ | ä¸¥é‡æ€§ | å¤„ç†å»ºè®® |
|---------|------|--------|---------|
| ERR001 | Link Down | Critical | æ£€æŸ¥ç‰©ç†è¿æ¥ |
| ERR002 | High BER | Critical | æ›´æ¢å…‰æ¨¡å— |
| ERR003 | Symbol Error | Critical | æ£€æŸ¥ä¿¡å·è´¨é‡ |
| ERR004 | High Temperature | Critical | æ”¹å–„æ•£çƒ­ |
| ERR005 | Congestion | Warning | ä¼˜åŒ–è·¯ç”± |
| ERR006 | Link Recovery | Warning | ç›‘æ§é¢‘ç‡ |
| ERR007 | FW Mismatch | Info | ç»Ÿä¸€å›ºä»¶ |
| ERR008 | Config Mismatch | Info | æ ‡å‡†åŒ–é…ç½® |

---

## é™„å½• B: å¸¸ç”¨é˜ˆå€¼å‚è€ƒ

| å‚æ•° | æ­£å¸¸èŒƒå›´ | è­¦å‘Šé˜ˆå€¼ | ä¸¥é‡é˜ˆå€¼ |
|-----|---------|---------|---------|
| æ¸©åº¦ | < 60Â°C | 70-79Â°C | â‰¥ 80Â°C |
| Symbol BER | 0 | > 0 | > 1e-12 |
| XmitWait æ¯”ä¾‹ | < 0.1% | 1-5% | > 5% |
| LinkDownedCounter | 0 | > 0 | > 10 |
| SymbolErrorCounter | 0 | > 0 | > 100 |
| å¸¦å®½åˆ©ç”¨ç‡ | < 50% | 50-70% | > 70% |

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0
**åŸºäº**: IBDiagnet User Manual v2.13.0
**æ›´æ–°æ—¥æœŸ**: 2026-01-03
**ä½œè€…**: Claude Code (å‘†å“¥ç§‘æŠ€)
