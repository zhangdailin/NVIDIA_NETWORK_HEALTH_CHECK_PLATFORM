# NVIDIA Network Health Check Platform - 功能增强计划

## 当前状态

IB-Analysis-Pro 已实现的核心功能：
- ✅ 传输分析 (xmit) - 背压检测、流量不均衡
- ✅ BER 分析 - 误码率检测、阈值告警
- ✅ 电缆分析 - 温度监控、厂商/型号异常
- ✅ HCA 分析 - 固件版本、设备类型
- ✅ 拥塞控制 - RTT 分析、CC 参数
- ✅ 端口统计 - 错误计数器、链路状态
- ✅ 拓扑可视化 - HTML 网络图

---

## 第一阶段：健康评分系统

### 1.1 统一健康评分 (Health Score)
**目标**: 提供 0-100 的网络健康评分

**实现方案**:
- 基于现有异常权重计算综合评分
- 分类: Critical (0-40), Warning (40-70), Healthy (70-100)
- 各模块权重: BER(30%), Cable(20%), Xmit(20%), Port(15%), CC(15%)

**文件**: `backend/ib_analysis/health_score.py`

### 1.2 问题严重性分级
- Critical: 链路故障、高 BER、端口 Down
- Warning: 高背压、温度告警、固件不一致
- Info: 轻微不均衡、低频错误

---

## 第二阶段：增强分析功能

### 2.1 拓扑验证
**目标**: 检测网络拓扑问题

**检测项**:
- 非对称连接 (Spine-Leaf 比例)
- 单点故障 (缺少冗余路径)
- 孤立节点
- 链路速率不匹配

**文件**: `backend/ib_analysis/topo_validator.py`

### 2.2 趋势分析 (需要多次采集)
**目标**: 检测错误计数器增长趋势

**功能**:
- 存储历史数据 (SQLite/JSON)
- 计算错误增长率
- 预测性告警

**文件**: `backend/ib_analysis/trend.py`

### 2.3 跨模块关联分析
**目标**: 发现问题根因

**关联规则**:
- 高 BER → 检查电缆温度/型号
- 高背压 → 检查 CC 配置
- 链路 Down → 检查物理层错误

**文件**: `backend/ib_analysis/correlation.py`

---

## 第三阶段：前端增强

### 3.1 仪表盘页面
- 健康评分大盘
- 关键指标卡片 (节点数、链路数、告警数)
- 问题分布饼图

### 3.2 问题列表页面
- 按严重性排序
- 过滤器 (模块、节点、时间)
- 问题详情展开

### 3.3 拓扑交互增强
- 点击节点显示详情
- 问题节点高亮
- 路径追踪

### 3.4 历史对比
- 上传多个快照
- 差异对比视图
- 变化趋势图表

---

## 第四阶段：报告生成

### 4.1 PDF 报告
- 执行摘要
- 健康评分
- 问题列表
- 建议措施

### 4.2 导出功能
- Excel 多 Sheet 导出
- JSON API 响应
- CSV 批量导出

---

## 实现优先级

| 优先级 | 功能 | 工作量 | 价值 |
|--------|------|--------|------|
| P0 | 健康评分系统 | 中 | 高 |
| P0 | 问题严重性分级 | 低 | 高 |
| P1 | 仪表盘页面 | 中 | 高 |
| P1 | 问题列表页面 | 中 | 高 |
| P2 | 拓扑验证 | 中 | 中 |
| P2 | 跨模块关联 | 高 | 中 |
| P3 | 趋势分析 | 高 | 中 |
| P3 | PDF 报告 | 中 | 低 |

---

## 技术栈

**后端新增**:
- SQLite (历史数据存储)
- ReportLab (PDF 生成)

**前端新增**:
- Recharts/Chart.js (图表)
- React Router (多页面)

---

## API 设计

```
GET  /api/health-score/{task_id}     # 获取健康评分
GET  /api/issues/{task_id}           # 获取问题列表
GET  /api/topology/{task_id}         # 获取拓扑数据
POST /api/compare                     # 对比两次分析
GET  /api/report/{task_id}/pdf       # 下载 PDF 报告
```

---

## 下一步行动

1. 确认优先级和范围
2. 实现健康评分系统 (P0)
3. 更新前端显示健康评分
4. 迭代添加其他功能
