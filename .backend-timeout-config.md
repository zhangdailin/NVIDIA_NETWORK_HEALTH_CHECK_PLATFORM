# 后端超时配置说明

## 问题描述
当处理大型 IBDiagnet 文件时，后端分析可能需要超过 5 分钟，导致前端超时错误。

## 已完成的修复

### 1. 前端超时配置 ✅
已更新前端超时设置：
- **IBDiagnet 文件**: 900000ms (15分钟)
- **CSV 文件**: 600000ms (10分钟)

文件位置: `frontend/src/App.jsx`

### 2. 启动后端时的超时配置

#### 使用 uvicorn 启动时，需要设置超时参数：

```bash
cd backend
uvicorn main:app --host 0.0.0.0 --port 8000 --timeout-keep-alive 1800
```

参数说明：
- `--timeout-keep-alive 1800`: 设置 keep-alive 超时为 30 分钟（1800秒）
- `--host 0.0.0.0`: 允许外部访问（如果只需本地访问，使用 127.0.0.1）
- `--port 8000`: 端口号

#### 推荐的生产环境配置

创建一个启动脚本 `start_backend.sh` (Linux/Mac) 或 `start_backend.bat` (Windows):

**Windows (start_backend.bat):**
```batch
@echo off
cd backend
uvicorn main:app --host 0.0.0.0 --port 8000 --timeout-keep-alive 1800 --workers 1
```

**Linux/Mac (start_backend.sh):**
```bash
#!/bin/bash
cd backend
uvicorn main:app --host 0.0.0.0 --port 8000 --timeout-keep-alive 1800 --workers 1
```

### 3. 使用 Gunicorn (生产环境推荐 - Linux only)

```bash
cd backend
gunicorn main:app \
  --bind 0.0.0.0:8000 \
  --worker-class uvicorn.workers.UvicornWorker \
  --workers 1 \
  --timeout 1800 \
  --graceful-timeout 30 \
  --keep-alive 1800
```

### 4. 使用 Nginx 反向代理时的配置

如果使用 Nginx，需要在 nginx.conf 中增加超时：

```nginx
location /api {
    proxy_pass http://localhost:8000;
    proxy_read_timeout 1800s;
    proxy_connect_timeout 1800s;
    proxy_send_timeout 1800s;
    client_max_body_size 500M;
}
```

## 用户体验改进

前端已优化加载提示：
1. 上传阶段显示进度条
2. 处理阶段显示"处理中，请耐心等待"
3. 提示用户后端正在分析大文件

## 测试建议

1. 启动后端：
```bash
cd backend
uvicorn main:app --host 0.0.0.0 --port 8000 --timeout-keep-alive 1800 --reload
```

2. 启动前端：
```bash
cd frontend
npm run dev
```

3. 上传大文件测试超时是否已解决

## 常见问题

**Q: 为什么还是超时？**
A: 检查以下几点：
1. 确认后端启动时添加了 `--timeout-keep-alive 1800` 参数
2. 检查浏览器控制台是否有其他错误
3. 查看后端日志，确认是否在处理过程中出现异常
4. 确认没有中间代理（如 Nginx）有更短的超时限制

**Q: 文件太大，15分钟也不够怎么办？**
A: 可以进一步增加超时时间：
- 前端: 修改 `App.jsx` 中的 `timeout` 值（单位：毫秒）
- 后端: 修改 uvicorn 的 `--timeout-keep-alive` 值（单位：秒）
